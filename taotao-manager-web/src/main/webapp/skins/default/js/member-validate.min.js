$.validator.setDefaults({
	highlight : function(e) {
		$(e).closest(".form-group").removeClass("has-success").addClass(
				"has-error")
	},
	success : function(e) {
		e.closest(".form-group").removeClass("has-error").addClass(
				"has-success")
	},
	errorElement : "span",
	errorPlacement : function(e, r) {
		e.appendTo(r.is(":radio") || r.is(":checkbox") ? r.parent().parent()
				.parent() : r.parent())
	},
	errorClass : "help-block m-b-none",
	validClass : "help-block m-b-none"
}), $().ready(function() {
	
	//获取参数
	var sd=GetArgsFromHref();
	console.log(sd);
	if (typeof(sd)!= "undefined"){ 
		$("#id").val(sd);
		//等select 加载完了，在加载其他
		 setTimeout(function () { 
			 onselectPower(sd);
		    }, 500);
	}
	var e = "<i class='fa fa-times-circle'></i> ";
	$("#signupForm").validate({
		rules : {
			username : "required",
			password : {
					required : !0,
					minlength : 6
			},
			password2 : {
				required : !0,
				minlength : 6,
				equalTo: "#password"
			},
			phone :  {
				required : !0,
				minlength : 11,
				maxlength : 11
			},
			email : {
				required : !0,
				email:true
			}
		},
		messages : {
			username : e+"请输入会员登陆名",
			password: {
					required : e+"请输入登陆密码",
					minlength : e+"登陆密码不能少于6位"
			},
			password2 : {
				required : e+"请输入确认密码",
				minlength :  e+"确认密码不能少于6位",
				equalTo: e+"两次密码输入不一致"
			},
			phone :  {
				required : e+"请输入手机号码",
				minlength : e+"请输入正确的手机号码",
				maxlength : e+"请输入正确的手机号码"
			},
			email : {
				required : e+"请输入常用邮箱",
				email:e+"请输入正确邮箱地址"
			}
			
		},submitHandler:function(form){  
				tjajx();
        }   
	});
});
//保存
function tjajx(){
	$.ajax({
		type : "post",
		url : "/member/createMember.do",
		data : $('#signupForm').serialize(),
		dataType : "json",
		success : function(data) {
			if(data.status=="200"){
				swal({title:"操作提示",text:"操作成功",type:"success",closeOnConfirm: false} ,
					function(){
					location.reload() 
					  });
			}else{
				swal({title:"操作提示",text:"操作失败", type:"error",closeOnConfirm: false })
			}
		}
	});
}


//ajax  查询 信息
function onselectPower(id){
	console.log(id);
	$.ajax({
		type : "GET",
		url : "/member/edit.do",
		data : "id="+id,
		dataType : "json",
		success : function(data) {
			if(data!=""){
				    $("#id").val(data.id);
				    $("#username").val(data.username);
				    $("#password").val(data.password);
				    $("#phone").val(data.phone);
				    $("#email").val(data.email);
			}else{
				swal({title:"操作提示",text:"获取会员信息出错,请联系管理员", type:"error" })
			}
		}
	});
}