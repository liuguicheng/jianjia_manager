$.validator.setDefaults({
	highlight : function(e) {
		$(e).closest(".form-group").removeClass("has-success").addClass(
				"has-error")
	},
	success : function(e) {
		e.closest(".form-group").removeClass("has-error").addClass(
				"has-success")
	},
	errorElement : "span",
	errorPlacement : function(e, r) {
		e.appendTo(r.is(":radio") || r.is(":checkbox") ? r.parent().parent()
				.parent() : r.parent())
	},
	errorClass : "help-block m-b-none",
	validClass : "help-block m-b-none"
}), $().ready(function() {
	
	//获取参数
	var sd=GetArgsFromHref();
	console.log(sd);
	if (typeof(sd)!= "undefined"){ 
		$("#roleId").val(sd);
		//等select 加载完了，在加载其他
		 setTimeout(function () { 
			 onselectPower(sd);
		    }, 500);
		 //修改title
		 $("#titleid").html("修改角色");
	}
	var e = "<i class='fa fa-times-circle'></i> ";
	$("#signupForm").validate({
		rules : {
			roleName : "required",
			sortOrder : {
					required : !0,
					digits:true,
					maxlength : 3
			}
		},
		messages : {
			sortOrder: {
					required: e + "请输入角色序号",
					maxlength: e + "角色序号最大3位数字",
					digits:e+"角色序号只能输入数字"
			},
			roleName : e + "请输入角色名称"
			
		},submitHandler:function(form){  
			//获取选择的 权限节点
			var  s=$('#using_json').jstree().get_checked();			
			//console.log(s);
			if(s.length!=0){
				$('#powerStr').val(s);
				tjajx(); 
			}else{
				alert("请选择菜单权限");
			}
            
        	
        }   
	});
});
//保存
function tjajx(){
	$.ajax({
		type : "post",
		url : "/role/save.do",
		data : $('#signupForm').serialize(),// ,
		dataType : "json",
		success : function(data) {
			if(data.status=="200"){
				swal({title:"操作提示",text:"操作成功",type:"success",closeOnConfirm: false} ,
					function(){
					location.reload() 
					  });
			}else{
				swal({title:"操作提示",text:"操作失败", type:"error",closeOnConfirm: false })
			}
		}
	});
}

//ajax  查询 角色信息并显示在html页面
function onselectPower(id){
	
	$.ajax({
		type : "GET",
		url : "/role/edit.do",
		data : "id="+id,
		dataType : "json",
		success : function(data) {
			if(data!=""){
				    $("#sortOrder").val(data.sortOrder);
				    $("#roleName").val(data.roleName);
				    $("#defaultHomeUrl").val(data.defaultHomeUrl);
				    $("#remark").val(data.remark);
				    $("#powerStr").val(data.powerstr);
			}else{
				swal({title:"操作提示",text:"获取角色详细出错,请联系管理员", type:"error" })
			}
		}
	});
}